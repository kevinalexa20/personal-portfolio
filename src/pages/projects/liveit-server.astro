---
import Layout from "~/layouts/PageLayout.astro";
import { Icon } from "astro-icon/components";
import Header from "~/components/widgets/Header.astro";

const metadata = {
  title: "LiveIt Server - Backend API | Kev Portfolio",
  description:
    "NestJS backend service with Prisma, PostgreSQL, JWT auth, Redis caching, rate limiting, and Appwrite integration for storage and media.",
};
---

<Layout metadata={metadata}>
  <Fragment slot="announcement"></Fragment>
  <Fragment slot="header">
    <Header
      links={[
        { text: "Home", href: "/" },
        { text: "About", href: "/#about" },
        { text: "Resume", href: "/#resume" },
        { text: "Portfolio", href: "/#portfolio" },
        { text: "Github", href: "https://github.com/kevinalexa20" },
      ]}
      actions={[{ text: "Hire me", href: "#" }]}
      isSticky
      showToggleTheme
    />
  </Fragment>

  <div class="mx-auto max-w-6xl px-4 py-16 md:px-8">
    <div class="mb-8">
      <a
        href="/#portfolio"
        class="inline-flex items-center text-blue-600 hover:text-blue-800 transition-colors">
        <Icon name="tabler:arrow-left" class="w-5 h-5 mr-2" /> Back to Portfolio
      </a>
    </div>

    <div class="mb-12">
      <h1
        class="text-3xl md:text-5xl font-bold text-gray-900 dark:text-white mb-4">
        LiveIt Server: Backend API Service
      </h1>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mt-8">
        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
          <h3 class="font-semibold text-gray-900 dark:text-white mb-2">
            Project
          </h3>
          <p class="text-gray-600 dark:text-gray-300">LiveIt Server (NestJS)</p>
        </div>
        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
          <h3 class="font-semibold text-gray-900 dark:text-white mb-2">
            My Role
          </h3>
          <p class="text-gray-600 dark:text-gray-300">Backend Developer</p>
        </div>
        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
          <h3 class="font-semibold text-gray-900 dark:text-white mb-2">
            Duration
          </h3>
          <p class="text-gray-600 dark:text-gray-300">2025 - Present</p>
        </div>
        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
          <h3 class="font-semibold text-gray-900 dark:text-white mb-2">
            Tech Stack
          </h3>
          <p class="text-gray-600 dark:text-gray-300">
            NestJS 11, Prisma, PostgreSQL, JWT, Redis, Throttler, Appwrite,
            Jest, Docker
          </p>
        </div>
        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
          <h3 class="font-semibold text-gray-900 dark:text-white mb-2">
            Key Features
          </h3>
          <p class="text-gray-600 dark:text-gray-300">
            JWT/OAuth Auth, Profiles, Habit Tracker (idempotent), Devotionals
            (Appwrite Tables), Redis cache & rate limits
          </p>
        </div>
      </div>

      <div class="flex flex-wrap gap-4 mt-8">
        <a
          href="#"
          class="inline-flex items-center px-6 py-3 bg-gray-800 text-white rounded-lg opacity-70 cursor-not-allowed">
          <Icon name="tabler:brand-github" class="w-5 h-5 mr-2" /> Private Repo
        </a>
      </div>
    </div>

    <div class="mb-12">
      <img
        src="/selfie-plus-app.png"
        alt="LiveIt Server Diagram"
        class="w-full h-auto object-contain rounded-lg shadow-lg"
      />
    </div>

    <div class="prose prose-lg max-w-none dark:prose-invert">
      <section class="mb-12">
        <h2 class="text-2xl md:text-3xl font-bold mb-6">Project Overview</h2>
        <p>
          LiveIt Server is a modular NestJS 11 backend powering authentication,
          profiles, habit tracking, and daily devotionals. It integrates
          PostgreSQL via Prisma, Appwrite for IdP/storage, and ships with
          operational concerns like caching, rate limiting, and Dockerized
          deployment. Caching is configurable: Redis in production, in-memory
          fallback when Redis is unavailable.
        </p>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl md:text-3xl font-bold mb-6">Core Modules</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg">
            <h3 class="text-xl font-semibold mb-3">
              Authentication & Profiles
            </h3>
            <ul class="list-disc pl-6 space-y-2">
              <li>
                JWT with issuer/audience via Passport strategy + Redis blacklist
              </li>
              <li>
                Email-claim flow with TTL in Redis; public profiles with privacy
              </li>
              <li>
                DTO validation and exception filters; throttling on sensitive
                routes
              </li>
            </ul>
          </div>
          <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg">
            <h3 class="text-xl font-semibold mb-3">Habit Tracker</h3>
            <ul class="list-disc pl-6 space-y-2">
              <li>
                Idempotent daily check-in/undo; archive without losing history
              </li>
              <li>
                Partial-unique constraint to prevent duplicate active habits
              </li>
              <li>
                Custom habits activate immediately with limited initial reach
                and moderation/reporting
              </li>
            </ul>
          </div>
          <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg">
            <h3 class="text-xl font-semibold mb-3">Devotionals</h3>
            <ul class="list-disc pl-6 space-y-2">
              <li>
                Appwrite Tables DB integration: today/list/get with query
                filters
              </li>
              <li>
                Like/unlike with counters; view count and estimated read time
              </li>
              <li>
                Create a habit from a devotional (cross-module integration)
              </li>
            </ul>
          </div>
          <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg">
            <h3 class="text-xl font-semibold mb-3">Appwrite & Media</h3>
            <ul class="list-disc pl-6 space-y-2">
              <li>Server SDK module for Users/Account, Tables, and Storage</li>
              <li>
                Env-driven config and featured image URL generation for public
                buckets
              </li>
            </ul>
          </div>
        </div>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl md:text-3xl font-bold mb-6">
          Security & Reliability
        </h2>
        <ul class="list-disc pl-6 space-y-2">
          <li>
            Global rate limiting via <code>@nestjs/throttler</code> with per-route
            overrides
          </li>
          <li>
            CacheModule with Redis store or in-memory fallback (<code
              >CACHE_DRIVER</code
            >)
          </li>
          <li>
            Prisma migrations and seed scripts; Docker Compose for API + Redis
          </li>
          <li>JWT guard + strategy with issuer/audience checks</li>
        </ul>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl md:text-3xl font-bold mb-6">
          Development & Operations
        </h2>
        <ul class="list-disc pl-6 space-y-2">
          <li>Local dev: <code>npm run start:dev</code> with hot reload</li>
          <li>
            Database: Prisma + PostgreSQL, migrations via <code
              >npm run migrate:deploy</code>
          </li>
          <li>
            Seeding: <code>npm run db:seed</code> or <code
              >npm run seed:devotionals</code>
          </li>
          <li>
            Quality: ESLint + Prettier, tests with Jest (<code
              >npm run test:cov</code
            >)
          </li>
          <li>Deployment: Dockerfile and docker-compose for production</li>
        </ul>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl md:text-3xl font-bold mb-6">Deployment (DigitalOcean App Platform)</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg">
            <h4 class="font-semibold mb-2">Service Setup</h4>
            <ul class="list-disc pl-6 space-y-2">
              <li>App Platform Web Service linked to repository</li>
              <li>Build command: <code>npm ci && npm run build</code></li>
              <li>Run command: <code>npm run start:prod</code> (App Platform sets <code>PORT</code>)</li>
              <li>Health check path: <code>/</code> (simple hello route)</li>
              <li>Scaling: 1 container to start; enable autoscale later</li>
            </ul>
          </div>
          <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg">
            <h4 class="font-semibold mb-2">Environment</h4>
            <ul class="list-disc pl-6 space-y-2">
              <li><code>NODE_ENV=production</code>, <code>JWT_KEY</code></li>
              <li><code>DATABASE_URL</code> (attach DO Managed PostgreSQL)</li>
              <li>Optional Redis: <code>CACHE_DRIVER=redis</code>, <code>REDIS_HOST</code>, <code>REDIS_PORT</code></li>
              <li><code>APP_URL</code>, <code>FRONTEND_URL</code></li>
              <li><code>APPWRITE_ENDPOINT</code>, <code>APPWRITE_PROJECT_ID</code>, <code>APPWRITE_API_KEY</code></li>
              <li>Devotionals IDs (DB/collections/bucket) when enabled</li>
            </ul>
          </div>
        </div>
        <ul class="list-disc pl-6 space-y-2 mt-4">
          <li>Connect repo → select main branch → set commands and env vars</li>
          <li>Attach Managed PostgreSQL; App Platform injects <code>DATABASE_URL</code></li>
          <li>First deploy: run <code>npm run migrate:deploy</code> (manually or pre-release step)</li>
          <li>Zero-downtime updates via rolling deploy; view logs in App Platform UI</li>
        </ul>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl md:text-3xl font-bold mb-6">
          Ownership & Outcomes
        </h2>
        <ul class="list-disc pl-6 space-y-2">
          <li>
            Defined module boundaries and contracts across Auth, Profiles,
            Habits, Devotionals
          </li>
          <li>
            Implemented guard/strategy patterns, DTO validation, and rate limits
            for safer defaults
          </li>
          <li>
            Designed a scalable cache strategy with Redis and graceful memory
            fallback
          </li>
        </ul>
      </section>
    </div>
  </div>
</Layout>
